{% extends "base.html" %}

{% block title %}–ò–≥—Ä—ã X5Tech{% endblock %}

{% block content %}
<div class="container">
    <h1>–ò–≥—Ä—ã X5Tech</h1>

    <!-- –í—ã–±–æ—Ä –∏–≥—Ä—ã -->
    <div id="game-selection" class="game-selection">
        <h2>–í—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä—É</h2>
        <div class="game-cards">
            <div class="game-card" data-game="truth-game">
                <h3>–ü—Ä–∞–≤–¥–∞ –∏–ª–∏ –ª–æ–∂—å</h3>
                <p>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–≤–æ–∏ –∑–Ω–∞–Ω–∏—è –æ –∫–æ–º–ø–∞–Ω–∏–∏ X5 Tech</p>
                <button class="btn btn-primary">–ò–≥—Ä–∞—Ç—å</button>
            </div>
            <div class="game-card" data-game="bug-game">
                <h3>–ù–∞–π–¥–∏ –±–∞–≥</h3>
                <p>–ù–∞–π–¥–∏—Ç–µ –æ—à–∏–±–∫–∏ –≤ –∫–æ–¥–µ –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —è–∑—ã–∫–∞—Ö –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è</p>
                <button class="btn btn-primary">–ò–≥—Ä–∞—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- –ò–≥—Ä–∞ "–ü—Ä–∞–≤–¥–∞ –∏–ª–∏ –ª–æ–∂—å" -->
    <div id="truth-game" class="game-container" style="display: none;">
        <div class="game-header">
            <button id="back-to-menu-truth" class="btn btn-secondary">‚Üê –ù–∞–∑–∞–¥ –∫ –≤—ã–±–æ—Ä—É –∏–≥—Ä</button>
            <h2>–ü—Ä–∞–≤–¥–∞ –∏–ª–∏ –ª–æ–∂—å –æ –∫–æ–º–ø–∞–Ω–∏–∏ X5 Tech</h2>
        </div>

        <div id="truth-game-rules" class="game-rules">
            <h3>–ü—Ä–∞–≤–∏–ª–∞ –∏–≥—Ä—ã</h3>
            <ul>
                <li>–í—ã –ø–æ–ª—É—á–∏—Ç–µ 5 —Å–ª—É—á–∞–π–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ –æ –∫–æ–º–ø–∞–Ω–∏–∏ X5 Tech</li>
                <li>1 –≤–µ—Ä–Ω—ã–π –æ—Ç–≤–µ—Ç = 1 –±–∞–ª–ª</li>
                <li>–ù–µ–≤–µ—Ä–Ω—ã–π –æ—Ç–≤–µ—Ç = 0 –±–∞–ª–ª–æ–≤</li>
                <li>–ù–∞ –∫–∞–∂–¥—ã–π –≤–æ–ø—Ä–æ—Å —É –≤–∞—Å –µ—Å—Ç—å 60 —Å–µ–∫—É–Ω–¥</li>
            </ul>
            <button id="start-truth-game" class="btn btn-primary">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
        </div>

        <div id="truth-game-play" class="game-play" style="display: none;">
            <div class="game-stats">
                <div class="score">–ë–∞–ª–ª—ã: <span id="truth-score">0</span>/5</div>
                <div class="timer">–í—Ä–µ–º—è: <span id="truth-timer">60</span> —Å–µ–∫</div>
                <div class="question-counter">–í–æ–ø—Ä–æ—Å <span id="truth-current-question">1</span>/5</div>
            </div>

            <div class="question-container">
                <h3 id="truth-question-text"></h3>
                <div class="answer-buttons">
                    <button id="truth-btn" class="btn btn-success">–ü—Ä–∞–≤–¥–∞</button>
                    <button id="false-btn" class="btn btn-danger">–õ–æ–∂—å</button>
                </div>
            </div>

            <div id="truth-result-message" class="result-message" style="display: none;"></div>
        </div>

        <div id="truth-game-results" class="game-results" style="display: none;">
            <h3>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏–≥—Ä—ã</h3>
            <p>–í—ã –Ω–∞–±—Ä–∞–ª–∏ <span id="truth-final-score">0</span> –∏–∑ 5 –±–∞–ª–ª–æ–≤!</p>
            <button id="restart-truth-game" class="btn btn-primary">–ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞</button>
        </div>
    </div>

    <!-- –ò–≥—Ä–∞ "–ù–∞–π–¥–∏ –±–∞–≥" -->
    <div id="bug-game" class="game-container" style="display: none;">
        <div class="game-header">
            <button id="back-to-menu-bug" class="btn btn-secondary">‚Üê –ù–∞–∑–∞–¥ –∫ –≤—ã–±–æ—Ä—É –∏–≥—Ä</button>
            <h2>–ù–∞–π–¥–∏ –±–∞–≥ –≤ –∫–æ–¥–µ</h2>
        </div>

        <div id="bug-game-rules" class="game-rules">
            <h3>–ü—Ä–∞–≤–∏–ª–∞ –∏–≥—Ä—ã</h3>
            <p>–í –∫–∞–∂–¥–æ–º –ø—Ä–∏–º–µ—Ä–µ –∫–æ–¥–∞ –Ω–∞–π–¥–∏—Ç–µ –æ–¥–Ω—É —Å—Ç—Ä–æ–∫—É, —Å–æ–¥–µ—Ä–∂–∞—â—É—é —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –∏–∑ –¥—Ä—É–≥–æ–≥–æ —è–∑—ã–∫–∞ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è.</p>
            <ul>
                <li>–í—ã –ø–æ–ª—É—á–∏—Ç–µ 5 –ø—Ä–∏–º–µ—Ä–æ–≤ –∫–æ–¥–∞ —Å –æ—à–∏–±–∫–∞–º–∏</li>
                <li>–ó–∞ –∫–∞–∂–¥—ã–π –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç –≤—ã –ø–æ–ª—É—á–∏—Ç–µ 2 –±–∞–ª–ª–∞</li>
                <li>–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç - 10 –±–∞–ª–ª–æ–≤</li>
            </ul>
            <button id="start-bug-game" class="btn btn-primary">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
        </div>

        <div id="bug-game-play" class="game-play" style="display: none;">
            <div class="game-stats">
                <div class="score">–ë–∞–ª–ª—ã: <span id="bug-score">0</span>/10</div>
                <div class="question-counter">–í–æ–ø—Ä–æ—Å <span id="bug-current-question">1</span>/5</div>
            </div>

            <div class="question-container">
                <div class="code-language">–Ø–∑—ã–∫: <span id="bug-language-name"></span></div>
                <pre id="bug-code-block" class="code-block"></pre>

                <div class="answer-section">
                    <p>–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–æ–∫—É —Å –æ—à–∏–±–∫–æ–π:</p>
                    <div id="bug-line-buttons" class="line-buttons"></div>
                </div>
            </div>

            <div id="bug-result-message" class="result-message" style="display: none;"></div>
        </div>

        <div id="bug-game-results" class="game-results" style="display: none;">
            <h3>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏–≥—Ä—ã</h3>
            <p>–í—ã –Ω–∞–±—Ä–∞–ª–∏ <span id="bug-final-score">0</span> –∏–∑ 10 –±–∞–ª–ª–æ–≤!</p>
            <button id="restart-bug-game" class="btn btn-primary">–ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞</button>
        </div>
    </div>
</div>

<style>
.container {
    max-width: 1000px;
    margin: 0 auto;
    padding: 20px;
}

.game-selection {
    text-align: center;
    margin-bottom: 40px;
}

.game-cards {
    display: flex;
    justify-content: center;
    gap: 30px;
    flex-wrap: wrap;
    margin-top: 30px;
}

.game-card {
    background: white;
    border-radius: 12px;
    padding: 30px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    width: 300px;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    border: 2px solid transparent;
}

.game-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.15);
    border-color: #007bff;
}

.game-card h3 {
    color: #333;
    margin-bottom: 15px;
    font-size: 1.5em;
}

.game-card p {
    color: #666;
    margin-bottom: 20px;
    line-height: 1.5;
}

.game-container {
    background: white;
    border-radius: 12px;
    padding: 30px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    margin-top: 20px;
}

.game-header {
    display: flex;
    align-items: center;
    margin-bottom: 30px;
    padding-bottom: 20px;
    border-bottom: 2px solid #f0f0f0;
}

.game-header h2 {
    margin: 0 auto;
    color: #333;
}

.game-rules, .game-play, .game-results {
    text-align: center;
}

.game-rules ul {
    text-align: left;
    display: inline-block;
    margin: 20px 0;
}

.game-stats {
    display: flex;
    justify-content: space-between;
    margin-bottom: 30px;
    padding: 15px;
    background: #f8f9fa;
    border-radius: 8px;
    font-weight: bold;
}

.question-container {
    margin-bottom: 30px;
}

.answer-buttons {
    margin-top: 30px;
}

.btn {
    margin: 0 10px;
    padding: 12px 25px;
    font-size: 16px;
    border-radius: 6px;
    transition: all 0.3s ease;
}

.btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
}

.code-language {
    font-weight: bold;
    margin-bottom: 15px;
    color: #495057;
    font-size: 1.1em;
}

.code-block {
    background-color: #2d2d2d;
    color: #f8f8f2;
    padding: 20px;
    border-radius: 8px;
    font-family: 'Courier New', monospace;
    white-space: pre-wrap;
    margin-bottom: 25px;
    text-align: left;
    font-size: 14px;
    line-height: 1.4;
    border-left: 4px solid #007bff;
}

.answer-section {
    margin-top: 25px;
    text-align: left;
}

.answer-section p {
    font-weight: bold;
    margin-bottom: 15px;
    color: #333;
}

.line-buttons {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.line-btn {
    text-align: left;
    padding: 12px 15px;
    background-color: #fff;
    border: 2px solid #e9ecef;
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.3s ease;
    font-family: 'Courier New', monospace;
    font-size: 14px;
}

.line-btn:hover {
    background-color: #f8f9fa;
    border-color: #007bff;
}

.line-btn.selected {
    background-color: #007bff;
    color: white;
    border-color: #007bff;
    transform: translateX(5px);
}

.result-message {
    text-align: center;
    font-weight: bold;
    font-size: 18px;
    padding: 15px;
    border-radius: 8px;
    margin-top: 25px;
}

.correct {
    background-color: #d4edda;
    color: #155724;
    border: 2px solid #c3e6cb;
}

.incorrect {
    background-color: #f8d7da;
    color: #721c24;
    border: 2px solid #f5c6cb;
}

.game-results {
    padding: 40px 20px;
}

.game-results h3 {
    color: #333;
    margin-bottom: 20px;
}

.game-results p {
    font-size: 1.2em;
    margin-bottom: 30px;
    color: #666;
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
@media (max-width: 768px) {
    .game-cards {
        flex-direction: column;
        align-items: center;
    }

    .game-card {
        width: 100%;
        max-width: 400px;
    }

    .game-stats {
        flex-direction: column;
        gap: 10px;
        text-align: center;
    }

    .answer-buttons {
        display: flex;
        flex-direction: column;
        gap: 10px;
    }

    .btn {
        margin: 5px 0;
    }
}
</style>

<script>
// –î–∞–Ω–Ω—ã–µ –¥–ª—è –∏–≥—Ä—ã "–ü—Ä–∞–≤–¥–∞ –∏–ª–∏ –ª–æ–∂—å"
const truthFacts = [
    { text: "X5 Tech ‚Äî IT-–∫–æ–º–ø–∞–Ω–∏—è –∏ –æ—Å–Ω–æ–≤–Ω–æ–π —Ü–∏—Ñ—Ä–æ–≤–æ–π –ø–∞—Ä—Ç–Ω—ë—Ä —Ç–æ—Ä–≥–æ–≤—ã—Ö —Å–µ—Ç–µ–π –∏ –±–∏–∑–Ω–µ—Å–æ–≤ X5 Group.", isTrue: true },
    { text: "X5 Tech —Ä–∞–∑—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ–Ω–ª–∞–π–Ω- –∏ –æ—Ñ–ª–∞–π–Ω-—Ä–µ—à–µ–Ω–∏—è –¥–ª—è –∫–æ–º–ø–∞–Ω–∏–π X5 Group.", isTrue: true },
    { text: "X5 Group —É–ø—Ä–∞–≤–ª—è–µ—Ç –∫—Ä—É–ø–Ω—ã–º–∏ —Ä–æ–∑–Ω–∏—á–Ω—ã–º–∏ —Å–µ—Ç—è–º–∏ ¬´–ü—è—Ç—ë—Ä–æ—á–∫–∞¬ª, ¬´–ü–µ—Ä–µ–∫—Ä—ë—Å—Ç–æ–∫¬ª –∏ ¬´–ß–∏–∂–∏–∫¬ª.", isTrue: true },
    { text: "–í X5 Tech —Ä–∞–±–æ—Ç–∞–µ—Ç –±–æ–ª–µ–µ 5000 —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤.", isTrue: true },
    { text: "–†–µ—à–µ–Ω–∏—è X5 Tech –ø–æ–º–æ–≥–∞—é—Ç —Å–æ—Ç–Ω—è–º —Ç—ã—Å—è—á —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ X5 Group —Ä–∞–±–æ—Ç–∞—Ç—å —Å —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–º –∫–æ–º—Ñ–æ—Ä—Ç–æ–º.", isTrue: true },
    { text: "–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ X5 Tech –µ–∂–µ–¥–Ω–µ–≤–Ω–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –º–∏–ª–ª–∏–æ–Ω—ã –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–π X5 Group.", isTrue: true },
    { text: "X5 Tech –∞–∫—Ç–∏–≤–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –±–æ–ª—å—à–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π –¥–ª—è —Ä–∏—Ç–µ–π–ª–∞.", isTrue: true },
    { text: "–í X5 Tech –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –º–µ—Ç–æ–¥—ã –º–∞—à–∏–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è –∏ –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–∞ –¥–ª—è –∑–∞–¥–∞—á —Ä–æ–∑–Ω–∏—á–Ω–æ–π —Ç–æ—Ä–≥–æ–≤–ª–∏.", isTrue: true },
    { text: "X5 Tech —É—á–∞—Å—Ç–≤—É–µ—Ç –≤ —Ä–∞–∑–≤–∏—Ç–∏–∏ —Ü–∏—Ñ—Ä–æ–≤—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ X5 Group, –≤–∫–ª—é—á–∞—è e-commerce –∏ –¥–æ—Å—Ç–∞–≤–∫—É.", isTrue: true },
    { text: "X5 Tech —Ä–∞–∑—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ü–∏—Ñ—Ä–æ–≤—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã –¥–ª—è –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–π –ø—Ä–æ–¥—É–∫—Ç–æ–≤—ã—Ö —Å–µ—Ç–µ–π X5 Group.", isTrue: true }
];

const falseFacts = [
    { text: "X5 Tech –±—ã–ª–∞ –æ—Å–Ω–æ–≤–∞–Ω–∞ –≤ 1995 –≥–æ–¥—É.", isTrue: false },
    { text: "X5 Tech —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ –Ω–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ –∏–≥—Ä.", isTrue: false },
    { text: "–ö–æ–º–ø–∞–Ω–∏—è X5 Tech –Ω–µ –∏–º–µ–µ—Ç –æ—Ç–Ω–æ—à–µ–Ω–∏—è –∫ –ø—Ä–æ–¥—É–∫—Ç–æ–≤—ã–º —Å–µ—Ç—è–º.", isTrue: false },
    { text: "–í X5 Tech —Ä–∞–±–æ—Ç–∞–µ—Ç –º–µ–Ω–µ–µ 100 —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤.", isTrue: false },
    { text: "X5 Tech –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–∞.", isTrue: false },
    { text: "X5 Tech —Ä–∞–∑—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ä–µ—à–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –¥–ª—è –∑–∞—Ä—É–±–µ–∂–Ω—ã—Ö –∫–æ–º–ø–∞–Ω–∏–π.", isTrue: false },
    { text: "X5 Tech –Ω–µ –∑–∞–Ω–∏–º–∞–µ—Ç—Å—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–æ–π –º–æ–±–∏–ª—å–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π.", isTrue: false },
    { text: "X5 Tech —è–≤–ª—è–µ—Ç—Å—è –¥–æ—á–µ—Ä–Ω–µ–π –∫–æ–º–ø–∞–Ω–∏–µ–π Google.", isTrue: false }
];

// –î–∞–Ω–Ω—ã–µ –¥–ª—è –∏–≥—Ä—ã "–ù–∞–π–¥–∏ –±–∞–≥"
const codeExamples = [
    {
        language: "Python",
        code: `def check_number(x):
    if (x % 2 == 0) {
        return True
    else:
        return False`,
        correctLine: 2,
        explanation: "–°—Ç—Ä–æ–∫–∞ 2 - –§–∏–≥—É—Ä–Ω—ã–µ —Å–∫–æ–±–∫–∏ { –≤–º–µ—Å—Ç–æ –¥–≤–æ–µ—Ç–æ—á–∏—è –≤ Python"
    },
    {
        language: "JavaScript",
        code: `function calculateSum(a, b) {
    let result = a + b
    print("Result: " + result)
    return result
}`,
        correctLine: 3,
        explanation: "–°—Ç—Ä–æ–∫–∞ 3 - print() –≤–º–µ—Å—Ç–æ console.log() –≤ JavaScript"
    },
    {
        language: "Python",
        code: `names = ["Alice", "Bob", "Charlie"]
for (let i = 0; i < names.length; i++):
    print(names[i])`,
        correctLine: 2,
        explanation: "–°—Ç—Ä–æ–∫–∞ 2 - –¶–∏–∫–ª for –≤ —Å—Ç–∏–ª–µ JavaScript –≤–º–µ—Å—Ç–æ Python"
    },
    {
        language: "Python",
        code: `const user = {
    name: "John",
    age: 25
}
if user.age >= 18:
    console.log("Adult")
else:
    console.log("Minor")`,
        correctLine: 4,
        explanation: "–°—Ç—Ä–æ–∫–∞ 4 - –°–∏–Ω—Ç–∞–∫—Å–∏—Å if —Å –¥–≤–æ–µ—Ç–æ—á–∏–µ–º –≤–º–µ—Å—Ç–æ —Ñ–∏–≥—É—Ä–Ω—ã—Ö —Å–∫–æ–±–æ–∫ –≤ JavaScript"
    },
    {
        language: "Python",
        code: `def factorial(n):
    if n == 0:
        return 1
    else:
        return n * factorial(n - 1)
    end`,
        correctLine: 6,
        explanation: "–°—Ç—Ä–æ–∫–∞ 6 - –ö–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ end –∏–∑ Ruby –≤–º–µ—Å—Ç–æ –æ—Ç—Å—Ç—É–ø–æ–≤ –≤ Python"
    }
];

// –°–æ—Å—Ç–æ—è–Ω–∏—è –∏–≥—Ä
let truthGameState = {
    score: 0,
    currentQuestion: 0,
    totalQuestions: 5,
    timer: null,
    timeLeft: 60,
    questions: []
};

let bugGameState = {
    score: 0,
    currentQuestion: 0,
    totalQuestions: 5,
    selectedLine: null,
    questions: []
};

// –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –∏–≥—Ä–∞–º
document.querySelectorAll('.game-card').forEach(card => {
    card.addEventListener('click', (e) => {
        if (e.target.tagName === 'BUTTON' || e.target.closest('button')) {
            const gameId = card.dataset.game;
            showGame(gameId);
        }
    });
});

document.getElementById('back-to-menu-truth').addEventListener('click', () => showGameSelection());
document.getElementById('back-to-menu-bug').addEventListener('click', () => showGameSelection());

function showGameSelection() {
    document.getElementById('game-selection').style.display = 'block';
    document.getElementById('truth-game').style.display = 'none';
    document.getElementById('bug-game').style.display = 'none';
}

function showGame(gameId) {
    document.getElementById('game-selection').style.display = 'none';
    document.querySelectorAll('.game-container').forEach(game => {
        game.style.display = 'none';
    });
    document.getElementById(gameId).style.display = 'block';

    // –°–±—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–≥—Ä—ã –ø—Ä–∏ –ø–æ–∫–∞–∑–µ
    if (gameId === 'truth-game') {
        resetTruthGame();
    } else if (gameId === 'bug-game') {
        resetBugGame();
    }
}

// –ò–≥—Ä–∞ "–ü—Ä–∞–≤–¥–∞ –∏–ª–∏ –ª–æ–∂—å"
function resetTruthGame() {
    document.getElementById('truth-game-rules').style.display = 'block';
    document.getElementById('truth-game-play').style.display = 'none';
    document.getElementById('truth-game-results').style.display = 'none';
    clearInterval(truthGameState.timer);
}

document.getElementById('start-truth-game').addEventListener('click', startTruthGame);
document.getElementById('restart-truth-game').addEventListener('click', startTruthGame);

function startTruthGame() {
    document.getElementById('truth-game-rules').style.display = 'none';
    document.getElementById('truth-game-play').style.display = 'block';
    document.getElementById('truth-game-results').style.display = 'none';

    // –°–æ–∑–¥–∞–µ–º –º–∞—Å—Å–∏–≤ –≤–æ–ø—Ä–æ—Å–æ–≤
    truthGameState.questions = [];
    const trueFacts = [...truthFacts].sort(() => 0.5 - Math.random()).slice(0, 3);
    const randomFalseFacts = [...falseFacts].sort(() => 0.5 - Math.random()).slice(0, 2);
    truthGameState.questions.push(...trueFacts, ...randomFalseFacts);
    truthGameState.questions = truthGameState.questions.sort(() => 0.5 - Math.random());

    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
    truthGameState.score = 0;
    truthGameState.currentQuestion = 0;
    document.getElementById('truth-score').textContent = '0';

    showTruthQuestion();
}

function showTruthQuestion() {
    clearInterval(truthGameState.timer);
    truthGameState.timeLeft = 60;
    document.getElementById('truth-timer').textContent = truthGameState.timeLeft;

    truthGameState.timer = setInterval(updateTruthTimer, 1000);

    document.getElementById('truth-current-question').textContent = truthGameState.currentQuestion + 1;

    const currentQuestion = truthGameState.questions[truthGameState.currentQuestion];
    document.getElementById('truth-question-text').textContent = currentQuestion.text;

    document.getElementById('truth-result-message').style.display = 'none';
    document.getElementById('truth-btn').disabled = false;
    document.getElementById('false-btn').disabled = false;
}

function updateTruthTimer() {
    truthGameState.timeLeft--;
    document.getElementById('truth-timer').textContent = truthGameState.timeLeft;

    if (truthGameState.timeLeft <= 0) {
        clearInterval(truthGameState.timer);
        handleTruthAnswer(false);
    }
}

function handleTruthAnswer(userAnswer) {
    clearInterval(truthGameState.timer);

    document.getElementById('truth-btn').disabled = true;
    document.getElementById('false-btn').disabled = true;

    const currentQuestion = truthGameState.questions[truthGameState.currentQuestion];
    const isCorrect = (userAnswer === currentQuestion.isTrue);

    if (isCorrect) {
        truthGameState.score++;
        document.getElementById('truth-score').textContent = truthGameState.score;
    }

    const resultMessage = document.getElementById('truth-result-message');
    resultMessage.textContent = isCorrect ? "–ü—Ä–∞–≤–∏–ª—å–Ω–æ!" : "–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ!";
    resultMessage.className = isCorrect ? "result-message correct" : "result-message incorrect";
    resultMessage.style.display = 'block';

    setTimeout(nextTruthQuestion, 2000);
}

function nextTruthQuestion() {
    truthGameState.currentQuestion++;

    if (truthGameState.currentQuestion < truthGameState.totalQuestions) {
        showTruthQuestion();
    } else {
        endTruthGame();
    }
}

document.getElementById('truth-btn').addEventListener('click', () => handleTruthAnswer(true));
document.getElementById('false-btn').addEventListener('click', () => handleTruthAnswer(false));

// –ò–≥—Ä–∞ "–ù–∞–π–¥–∏ –±–∞–≥"
function resetBugGame() {
    document.getElementById('bug-game-rules').style.display = 'block';
    document.getElementById('bug-game-play').style.display = 'none';
    document.getElementById('bug-game-results').style.display = 'none';
}

document.getElementById('start-bug-game').addEventListener('click', startBugGame);
document.getElementById('restart-bug-game').addEventListener('click', startBugGame);

function startBugGame() {
    document.getElementById('bug-game-rules').style.display = 'none';
    document.getElementById('bug-game-play').style.display = 'block';
    document.getElementById('bug-game-results').style.display = 'none';

    // –°–æ–∑–¥–∞–µ–º –º–∞—Å—Å–∏–≤ –≤–æ–ø—Ä–æ—Å–æ–≤
    bugGameState.questions = [...codeExamples].sort(() => 0.5 - Math.random());

    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
    bugGameState.score = 0;
    bugGameState.currentQuestion = 0;
    bugGameState.selectedLine = null;
    document.getElementById('bug-score').textContent = '0';

    showBugQuestion();
}

function showBugQuestion() {
    document.getElementById('bug-current-question').textContent = bugGameState.currentQuestion + 1;
    document.getElementById('bug-score').textContent = bugGameState.score;

    const currentQuestion = bugGameState.questions[bugGameState.currentQuestion];
    document.getElementById('bug-language-name').textContent = currentQuestion.language;
    document.getElementById('bug-code-block').textContent = currentQuestion.code;

    createBugLineButtons(currentQuestion.code);

    document.getElementById('bug-result-message').style.display = 'none';
    bugGameState.selectedLine = null;
}

function createBugLineButtons(code) {
    const lineButtonsContainer = document.getElementById('bug-line-buttons');
    lineButtonsContainer.innerHTML = '';

    const lines = code.split('\n');

    lines.forEach((line, index) => {
        const lineNumber = index + 1;
        const button = document.createElement('button');
        button.className = 'line-btn';
        button.textContent = `–°—Ç—Ä–æ–∫–∞ ${lineNumber}: ${line}`;
        button.dataset.line = lineNumber;

        button.addEventListener('click', () => {
            document.querySelectorAll('#bug-line-buttons .line-btn').forEach(btn => {
                btn.classList.remove('selected');
            });

            button.classList.add('selected');
            bugGameState.selectedLine = lineNumber;
        });

        lineButtonsContainer.appendChild(button);
    });

    const submitButton = document.createElement('button');
    submitButton.className = 'btn btn-primary submit-btn';
    submitButton.textContent = '–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç–≤–µ—Ç';
    submitButton.addEventListener('click', checkBugAnswer);
    lineButtonsContainer.appendChild(submitButton);
}

function checkBugAnswer() {
    if (bugGameState.selectedLine === null) {
        alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–æ–∫—É —Å –æ—à–∏–±–∫–æ–π');
        return;
    }

    const currentQuestion = bugGameState.questions[bugGameState.currentQuestion];
    const isCorrect = (bugGameState.selectedLine === currentQuestion.correctLine);

    if (isCorrect) {
        bugGameState.score += 2;
        document.getElementById('bug-score').textContent = bugGameState.score;
    }

    const resultMessage = document.getElementById('bug-result-message');
    resultMessage.textContent = isCorrect
        ? "–ü—Ä–∞–≤–∏–ª—å–Ω–æ! " + currentQuestion.explanation
        : "–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ! " + currentQuestion.explanation;
    resultMessage.className = isCorrect ? "result-message correct" : "result-message incorrect";
    resultMessage.style.display = 'block';

    document.querySelectorAll('#bug-line-buttons .line-btn').forEach(btn => {
        btn.disabled = true;
    });
    document.querySelector('#bug-line-buttons .submit-btn').disabled = true;

    setTimeout(nextBugQuestion, 3000);
}

function nextBugQuestion() {
    bugGameState.currentQuestion++;

    if (bugGameState.currentQuestion < bugGameState.totalQuestions) {
        showBugQuestion();
    } else {
        endBugGame();
    }
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∏–≥—Ä—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä
async function sendGameResults(gameType, score, totalPoints) {
    try {
        const formData = new FormData();
        formData.append('game_type', gameType);
        formData.append('score', score);
        formData.append('total_points', totalPoints);

        const response = await fetch('/api/game/complete', {
            method: 'POST',
            body: formData,
            credentials: 'include'
        });

        const result = await response.json();

        if (result.success) {
            console.log(`‚úÖ –ò–≥—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞! –ë–∞–ª–ª—ã: +${result.points_earned}, –í—Å–µ–≥–æ: ${result.new_points}, –ò–≥—Ä —Å—ã–≥—Ä–∞–Ω–æ: ${result.games_played}`);

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            showPointsNotification(result.points_earned, result.new_points, result.games_played, result.average_score);
        } else {
            console.error('‚ùå –û—à–∏–±–∫–∞ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –±–∞–ª–ª–æ–≤:', result.error);
        }
    } catch (error) {
        console.error('‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:', error);
    }
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–∞—á–∏—Å–ª–µ–Ω–Ω—ã—Ö –±–∞–ª–ª–∞—Ö
function showPointsNotification(pointsEarned, totalPoints, gamesPlayed, averageScore) {
    const notification = document.createElement('div');
    notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: linear-gradient(135deg, #5FAF2D, #4d9525);
        color: white;
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        z-index: 1000;
        font-weight: bold;
        animation: slideIn 0.3s ease;
        max-width: 300px;
        border-left: 5px solid #4d9525;
    `;

    notification.innerHTML = `
        <div style="font-size: 1.2em; margin-bottom: 10px;">üéâ –û—Ç–ª–∏—á–Ω–æ!</div>
        <div style="margin-bottom: 5px;">+${pointsEarned} –±–∞–ª–ª–æ–≤</div>
        <div style="margin-bottom: 5px;">–í—Å–µ–≥–æ –±–∞–ª–ª–æ–≤: ${totalPoints}</div>
        <div style="margin-bottom: 5px;">–°—ã–≥—Ä–∞–Ω–æ –∏–≥—Ä: ${gamesPlayed}</div>
        <div>–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª: ${averageScore}</div>
    `;

    document.body.appendChild(notification);

    setTimeout(() => {
        notification.style.animation = 'slideOut 0.3s ease';
        setTimeout(() => {
            notification.remove();
        }, 300);
    }, 5000);
}

// –î–æ–±–∞–≤—å—Ç–µ –∞–Ω–∏–º–∞—Ü–∏–∏ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
const style = document.createElement('style');
style.textContent = `
    @keyframes slideIn {
        from { transform: translateX(100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
    }
    @keyframes slideOut {
        from { transform: translateX(0); opacity: 1; }
        to { transform: translateX(100%); opacity: 0; }
    }
`;
document.head.appendChild(style);

function endTruthGame() {
    document.getElementById('truth-game-play').style.display = 'none';
    document.getElementById('truth-game-results').style.display = 'block';
    document.getElementById('truth-final-score').textContent = truthGameState.score;

    // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –±–∞–ª–ª—ã –¥–ª—è "–ü—Ä–∞–≤–¥–∞ –∏–ª–∏ –ª–æ–∂—å" (1 –±–∞–ª–ª –∑–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç)
    const pointsEarned = truthGameState.score;

    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä
    sendGameResults('truth_or_lie', truthGameState.score, pointsEarned);
}

function endBugGame() {
    document.getElementById('bug-game-play').style.display = 'none';
    document.getElementById('bug-game-results').style.display = 'block';
    document.getElementById('bug-final-score').textContent = bugGameState.score;

    // –í –∏–≥—Ä–µ "–ù–∞–π–¥–∏ –±–∞–≥" —É–∂–µ 2 –±–∞–ª–ª–∞ –∑–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç
    const pointsEarned = bugGameState.score;

    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä
    sendGameResults('find_bug', bugGameState.score, pointsEarned);
}



// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
showGameSelection();

</script>
{% endblock %}